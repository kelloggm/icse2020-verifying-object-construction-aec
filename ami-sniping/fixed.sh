#!/bin/sh

# this script runs the experiment again on the "fixed" versions of the benchmarks - that is, with
# annotations and triaging results applied.

# the occ-classpath file is generated by running ./gradlew printClasspath in the occ
# repository's main directory
# TODO: once this is on a VM, regenerate that classpath so that it is correct

# TODO: also make sure this path is correct on the VM
export JAVA8_HOME=/usr/lib/jvm/java-1.8.0-openjdk
export JAVA_HOME=${JAVA8_HOME}
export CHECKERFRAMEWORK=`pwd`/checker-framework

OUT=fixed

rm -rf ${OUT}-results

bash run-dljc.sh -o ${OUT} \
 -i fixed.in \
 -c org.checkerframework.checker.objectconstruction.ObjectConstructionChecker \
 -q '/homes/gws/kelloggm/occ-experiments/dec-2019-dljc-runs/object-construction-checker/object-construction-qual/build/libs/object-construction-qual.jar:/homes/gws/kelloggm/occ-experiments/dec-2019-dljc-runs/object-construction-checker/returnsrcvr-qual/build/libs/returnsrcvr-qual.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.checkerframework/checker-qual/3.0.0/4eebebb664c30555364865e3f5712511e7084c52/checker-qual-3.0.0.jar' \
 -l '/homes/gws/kelloggm/occ-experiments/dec-2019-dljc-runs/object-construction-checker/object-construction-checker/build/libs/object-construction-checker.jar:/homes/gws/kelloggm/occ-experiments/dec-2019-dljc-runs/object-construction-checker/returnsrcvr-checker/build/libs/returnsrcvr-checker.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.checkerframework/checker/3.0.0/47cd7831748000855ce95c39c965cf50a35412e2/checker-3.0.0.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.guava/guava/28.0-jre/54fed371b4b8a8cce1e94a9abd9620982d3aa54b/guava-28.0-jre.jar:/homes/gws/kelloggm/occ-experiments/dec-2019-dljc-runs/object-construction-checker/object-construction-qual/build/libs/object-construction-qual.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.springframework/spring-expression/5.1.7.RELEASE/7b47446553c83a5a7323d647f5c1793106b2948c/spring-expression-5.1.7.RELEASE.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.auto.value/auto-value-annotations/1.6.5/c3dad10377f0e2242c9a4b88e9704eaf79103679/auto-value-annotations-1.6.5.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.guava/failureaccess/1.0.1/1dcf1de382a0bf95a3d8b0849546c88bac1292c9/failureaccess-1.0.1.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/b421526c5f297295adef1c886e5246c39d4ac629/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.code.findbugs/jsr305/3.0.2/25ea2e8b0c338a877313bd4672d3fe056ea78f0d/jsr305-3.0.2.jar:/homes/gws/kelloggm/occ-experiments/dec-2019-dljc-runs/object-construction-checker/returnsrcvr-qual/build/libs/returnsrcvr-qual.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.checkerframework/checker-qual/3.0.0/4eebebb664c30555364865e3f5712511e7084c52/checker-qual-3.0.0.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.errorprone/error_prone_annotations/2.3.2/d1a0c5032570e0f64be6b4d9c90cdeb103129029/error_prone_annotations-2.3.2.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/com.google.j2objc/j2objc-annotations/1.3/ba035118bc8bac37d7eff77700720999acd9986d/j2objc-annotations-1.3.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.codehaus.mojo/animal-sniffer-annotations/1.17/f97ce6decaea32b36101e37979f8b647f00681fb/animal-sniffer-annotations-1.17.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.springframework/spring-core/5.1.7.RELEASE/280f821b9ed4dad9993f1d551d6e86557092ae58/spring-core-5.1.7.RELEASE.jar:/homes/gws/kelloggm/.gradle/caches/modules-2/files-2.1/org.springframework/spring-jcl/5.1.7.RELEASE/6b14bfb9ae41ca1bc604fe2e78f4a6efa3d67002/spring-jcl-5.1.7.RELEASE.jar' \
 -s `pwd`/object-construction-checker/object-construction-checker/stubs
